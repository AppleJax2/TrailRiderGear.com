---
export interface EBikeSpec {
  name: string;
  brand: string;
  motor: string;
  battery: string;
  topSpeed: string;
  range: string;
  price: string;
  badge?: string;
  asin?: string;
}

export interface Props {
  bikes: EBikeSpec[];
  title?: string;
}

const { bikes, title = "Quick Specs Comparison" } = Astro.props;
const affiliateTag = 'trailridergea-20';
---

<div class="spec-table-container not-prose">
  <div class="spec-header">
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <rect x="3" y="3" width="18" height="18" rx="2"/>
      <path d="M3 9h18"/>
      <path d="M3 15h18"/>
      <path d="M9 3v18"/>
    </svg>
    <h3>{title}</h3>
  </div>

  <!-- Desktop table -->
  <div class="spec-scroll">
    <table class="spec-table">
      <thead>
        <tr>
          <th class="col-name">E-Bike</th>
          <th>Motor</th>
          <th>Battery</th>
          <th>Top Speed</th>
          <th>Range</th>
          <th>Price</th>
        </tr>
      </thead>
      <tbody>
        {bikes.map((bike, i) => (
          <tr class={i === 0 ? 'top-pick' : ''}>
            <td class="cell-name">
              <div class="bike-name-wrap">
                {bike.badge && <span class="spec-badge">{bike.badge}</span>}
                <span class="bike-brand">{bike.brand}</span>
                {bike.asin ? (
                  <a href={`https://www.amazon.com/dp/${bike.asin}?tag=${affiliateTag}`} target="_blank" rel="nofollow sponsored" class="bike-name-link">{bike.name}</a>
                ) : (
                  <span class="bike-name">{bike.name}</span>
                )}
              </div>
            </td>
            <td><span class="spec-value">{bike.motor}</span></td>
            <td><span class="spec-value">{bike.battery}</span></td>
            <td><span class="spec-value spec-speed">{bike.topSpeed}</span></td>
            <td><span class="spec-value">{bike.range}</span></td>
            <td><span class="spec-value spec-price">{bike.price}</span></td>
          </tr>
        ))}
      </tbody>
    </table>
  </div>

  <!-- Mobile cards -->
  <div class="spec-cards">
    {bikes.map((bike, i) => (
      <div class={`spec-card ${i === 0 ? 'top-pick' : ''}`}>
        <div class="card-top">
          {bike.badge && <span class="spec-badge">{bike.badge}</span>}
          <span class="bike-brand">{bike.brand}</span>
          {bike.asin ? (
            <a href={`https://www.amazon.com/dp/${bike.asin}?tag=${affiliateTag}`} target="_blank" rel="nofollow sponsored" class="bike-name-link">{bike.name}</a>
          ) : (
            <span class="bike-name">{bike.name}</span>
          )}
        </div>
        <div class="card-specs">
          <div class="card-spec"><span class="spec-label">Motor</span><span class="spec-val">{bike.motor}</span></div>
          <div class="card-spec"><span class="spec-label">Battery</span><span class="spec-val">{bike.battery}</span></div>
          <div class="card-spec"><span class="spec-label">Top Speed</span><span class="spec-val">{bike.topSpeed}</span></div>
          <div class="card-spec"><span class="spec-label">Range</span><span class="spec-val">{bike.range}</span></div>
          <div class="card-spec price-spec"><span class="spec-label">Price</span><span class="spec-val spec-price">{bike.price}</span></div>
        </div>
      </div>
    ))}
  </div>

  <div class="spec-note">
    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
    Specs from manufacturer listings. Real-world performance varies by rider weight, terrain, and conditions.
  </div>
</div>

<style>
  .spec-table-container {
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: 16px;
    padding: 1.5rem;
    margin: 2rem 0;
  }

  .spec-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1.25rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--color-border);
  }

  .spec-header svg { color: var(--color-primary); }

  .spec-header h3 {
    font-size: 1.125rem;
    font-weight: 700;
    margin: 0;
    color: var(--color-text);
  }

  /* Desktop table */
  .spec-scroll {
    overflow-x: auto;
    margin: 0 -1.5rem;
    padding: 0 1.5rem;
  }

  .spec-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.875rem;
    min-width: 680px;
  }

  .spec-table th {
    text-align: left;
    padding: 0.625rem 0.75rem;
    font-weight: 600;
    color: var(--color-text-muted);
    text-transform: uppercase;
    font-size: 0.625rem;
    letter-spacing: 0.5px;
    border-bottom: 2px solid var(--color-border);
    white-space: nowrap;
  }

  .spec-table td {
    padding: 0.875rem 0.75rem;
    border-bottom: 1px solid var(--color-border);
    vertical-align: middle;
  }

  .spec-table tbody tr:last-child td { border-bottom: none; }

  .spec-table tbody tr:hover { background: rgba(139, 157, 119, 0.05); }

  .spec-table tbody tr.top-pick { background: rgba(139, 157, 119, 0.08); }
  .spec-table tbody tr.top-pick td { border-bottom-color: var(--color-primary); }

  .col-name { min-width: 180px; }

  .bike-name-wrap {
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
  }

  .spec-badge {
    display: inline-block;
    font-size: 0.625rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    color: var(--color-primary);
    background: rgba(74, 103, 65, 0.1);
    padding: 0.125rem 0.5rem;
    border-radius: 4px;
    width: fit-content;
    margin-bottom: 0.125rem;
  }

  .dark .spec-badge { background: rgba(124, 179, 66, 0.15); }

  .bike-brand {
    font-size: 0.6875rem;
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.03em;
  }

  .bike-name, .bike-name-link {
    font-weight: 600;
    font-size: 0.8125rem;
    color: var(--color-text);
    line-height: 1.3;
  }

  .bike-name-link {
    text-decoration: none;
    border-bottom: 1px solid var(--color-border);
    transition: border-color 0.2s;
  }

  .bike-name-link:hover { border-color: var(--color-primary); color: var(--color-primary); }

  .spec-value {
    font-size: 0.8125rem;
    color: var(--color-text);
  }

  .spec-speed { font-weight: 600; }
  .spec-price { font-weight: 700; color: var(--color-primary); }

  /* Mobile cards */
  .spec-cards { display: none; }

  @media (max-width: 720px) {
    .spec-scroll { display: none; }
    .spec-cards {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .spec-card {
      border: 1px solid var(--color-border);
      border-radius: 10px;
      padding: 1rem;
      background: var(--color-background);
    }

    .spec-card.top-pick {
      border-color: var(--color-primary);
      background: rgba(139, 157, 119, 0.05);
    }

    .card-top {
      display: flex;
      flex-direction: column;
      gap: 0.125rem;
      margin-bottom: 0.75rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid var(--color-border);
    }

    .card-specs {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.5rem;
    }

    .card-spec {
      display: flex;
      flex-direction: column;
      gap: 0.125rem;
    }

    .price-spec { grid-column: span 2; }

    .spec-label {
      font-size: 0.625rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: var(--color-text-muted);
    }

    .spec-val {
      font-size: 0.8125rem;
      font-weight: 500;
      color: var(--color-text);
    }
  }

  .spec-note {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    margin-top: 1rem;
    padding-top: 0.75rem;
    border-top: 1px solid var(--color-border);
    font-size: 0.75rem;
    color: var(--color-text-light);
  }

  .spec-note svg { flex-shrink: 0; }
</style>
